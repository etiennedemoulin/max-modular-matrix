{"version":3,"names":["fs","path","JSON5","DEFAULT_ENV_CONFIG","type","port","useHttps","serverAddress","loadConfig","ENV","callerURL","env","app","envConfigFilepath","join","parse","readFileSync","err","console","info","process","PORT","appConfigFilepath","error","exit","dirname","parent","resolve","role","relative"],"sources":["../../src/utils/load-config.js"],"sourcesContent":["import fs from 'node:fs';\nimport path from 'node:path';\n\nimport JSON5 from 'json5';\n\nconst DEFAULT_ENV_CONFIG = {\n  type: 'development',\n  port: 8000,\n  useHttps: false,\n  serverAddress: '127.0.0.1',\n};\n\n/**\n * Load JS config object from json5 config files located in `/config`.\n *\n * @param {String} [ENV='default'] - name of the environment. Should correspond\n *  to a file located in the `/config/env/` directory. If the file is not found\n *  the DEFAULT_CONFIG object will be used\n * @param {String} [callerURL=null] - for node clients, if `callerURL` is given,\n *  retrieves the `role` from caller directory name.\n *\n * @returns {Object} config\n * @returns {Object} config.app - JS object of the informations contained in\n *  `/config/application.json`.\n * @returns {Object} config.env - JS object of the informations contained in\n *  `/config/env/${ENV}.json` with ENV being the first argument.\n * @returns {Object} config.role - node client only: type/role of the client\n *  as defined when the client has been created (see `/config/application.json`\n *  and directory name).\n */\nexport function loadConfig(ENV = 'default', callerURL = null) {\n  let env = null;\n  let app = null;\n\n  // parse env config\n  const envConfigFilepath = path.join('config', `env-${ENV}.json`);\n\n  try {\n    env = JSON5.parse(fs.readFileSync(envConfigFilepath, 'utf-8'));\n  } catch(err) {\n    console.info('');\n    console.info('--------------------------------------------------------');\n    console.info(`- Environment config file not found: \"${envConfigFilepath}\"`);\n    console.info(`- Using default config:`);\n    console.info(DEFAULT_ENV_CONFIG);\n    console.info('- run `npx soundworks --create-env` to create a custom environment file');\n    console.info('--------------------------------------------------------');\n\n    env = DEFAULT_ENV_CONFIG;\n  }\n\n  if (process.env.PORT) {\n    env.port = process.env.PORT;\n  }\n\n  // parse app config\n  const appConfigFilepath = path.join('config', 'application.json');\n\n  try {\n    app = JSON5.parse(fs.readFileSync(appConfigFilepath, 'utf-8'));\n  } catch(err) {\n    console.error(`Invalid app config file: ${appConfigFilepath}`);\n    process.exit(1);\n  }\n\n  if (callerURL !== null) {\n    // we can grab the role from the caller url dirname\n    const dirname = path.dirname(callerURL);\n    const parent = path.resolve(dirname, '..');\n    const role = path.relative(parent, dirname);\n\n    if (role !== 'server') {\n      return { role, env, app };\n    } else {\n      return { env, app };\n    }\n  } else {\n    return { env, app };\n  }\n}\n"],"mappings":"AAAA,OAAOA,EAAE,MAAM,SAAS;AACxB,OAAOC,IAAI,MAAM,WAAW;AAE5B,OAAOC,KAAK,MAAM,OAAO;AAEzB,MAAMC,kBAAkB,GAAG;EACzBC,IAAI,EAAE,aAAa;EACnBC,IAAI,EAAE,IAAI;EACVC,QAAQ,EAAE,KAAK;EACfC,aAAa,EAAE;AACjB,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,UAAUA,CAACC,GAAG,GAAG,SAAS,EAAEC,SAAS,GAAG,IAAI,EAAE;EAC5D,IAAIC,GAAG,GAAG,IAAI;EACd,IAAIC,GAAG,GAAG,IAAI;;EAEd;EACA,MAAMC,iBAAiB,GAAGZ,IAAI,CAACa,IAAI,CAAC,QAAQ,EAAG,OAAML,GAAI,OAAM,CAAC;EAEhE,IAAI;IACFE,GAAG,GAAGT,KAAK,CAACa,KAAK,CAACf,EAAE,CAACgB,YAAY,CAACH,iBAAiB,EAAE,OAAO,CAAC,CAAC;EAChE,CAAC,CAAC,OAAMI,GAAG,EAAE;IACXC,OAAO,CAACC,IAAI,CAAC,EAAE,CAAC;IAChBD,OAAO,CAACC,IAAI,CAAC,0DAA0D,CAAC;IACxED,OAAO,CAACC,IAAI,CAAE,yCAAwCN,iBAAkB,GAAE,CAAC;IAC3EK,OAAO,CAACC,IAAI,CAAE,yBAAwB,CAAC;IACvCD,OAAO,CAACC,IAAI,CAAChB,kBAAkB,CAAC;IAChCe,OAAO,CAACC,IAAI,CAAC,yEAAyE,CAAC;IACvFD,OAAO,CAACC,IAAI,CAAC,0DAA0D,CAAC;IAExER,GAAG,GAAGR,kBAAkB;EAC1B;EAEA,IAAIiB,OAAO,CAACT,GAAG,CAACU,IAAI,EAAE;IACpBV,GAAG,CAACN,IAAI,GAAGe,OAAO,CAACT,GAAG,CAACU,IAAI;EAC7B;;EAEA;EACA,MAAMC,iBAAiB,GAAGrB,IAAI,CAACa,IAAI,CAAC,QAAQ,EAAE,kBAAkB,CAAC;EAEjE,IAAI;IACFF,GAAG,GAAGV,KAAK,CAACa,KAAK,CAACf,EAAE,CAACgB,YAAY,CAACM,iBAAiB,EAAE,OAAO,CAAC,CAAC;EAChE,CAAC,CAAC,OAAML,GAAG,EAAE;IACXC,OAAO,CAACK,KAAK,CAAE,4BAA2BD,iBAAkB,EAAC,CAAC;IAC9DF,OAAO,CAACI,IAAI,CAAC,CAAC,CAAC;EACjB;EAEA,IAAId,SAAS,KAAK,IAAI,EAAE;IACtB;IACA,MAAMe,OAAO,GAAGxB,IAAI,CAACwB,OAAO,CAACf,SAAS,CAAC;IACvC,MAAMgB,MAAM,GAAGzB,IAAI,CAAC0B,OAAO,CAACF,OAAO,EAAE,IAAI,CAAC;IAC1C,MAAMG,IAAI,GAAG3B,IAAI,CAAC4B,QAAQ,CAACH,MAAM,EAAED,OAAO,CAAC;IAE3C,IAAIG,IAAI,KAAK,QAAQ,EAAE;MACrB,OAAO;QAAEA,IAAI;QAAEjB,GAAG;QAAEC;MAAI,CAAC;IAC3B,CAAC,MAAM;MACL,OAAO;QAAED,GAAG;QAAEC;MAAI,CAAC;IACrB;EACF,CAAC,MAAM;IACL,OAAO;MAAED,GAAG;MAAEC;IAAI,CAAC;EACrB;AACF"}
